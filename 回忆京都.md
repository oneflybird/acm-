# P5239 回忆京都

## 题目背景

第十五届东方人气投票 音乐部门 106名

第四次国内不知道东方的人对东方原曲的投票调查 51名

回忆京都副歌我tm吹爆，东方文花帖我tm吹爆！

## 题目描述

射命丸文在取材中发现了一个好玩的东西，叫做组合数。

组合数的定义如下：从n*n*个不同元素中，任取m(m \leq n)*m*(*m*≤*n*)个元素并成一组，叫做从n*n*个不同元素中取出m*m*个元素的一个组合。所有组合的数量，就是组合数。

组合数的计算公式如下：C^m_n=\dfrac{n!}{m! \times (n-m)!}*C**n**m*=*m*!×(*n*−*m*)!*n*!，其中保证m \leq n*m*≤*n*，表示在n*n*个元素中选出m*m*个元素的组合数。

为了方便理解，举一个例子：在th16.5秘封噩梦日记的第三周目中，每一天的战斗都有44个角色两两组合出场，那么很显然就有C^2_4=6*C*42=6种组合方式。

关于这方面的更详细解释，请看样例说明。

由于她对新事物都存在着好奇，因此她想要知道C^m_n*C**n**m*是多少。这对她来说是个很简单的事情，因此她看了一眼就秒了，因此她决定求出下列式子：

\sum_{i=1}^n \sum_{j=1}^m C^i_j∑*i*=1*n*∑*j*=1*m**C**j**i*，其中当i>j*i*>*j*的时候，钦定C^i_j*C**j**i*为00

她也很快就算出来了，不过对自己的答案不是很充满信心，因此你决定帮助她。然而没事找事的她一下子算了q*q*次对于不同的n,m*n*,*m*的结果，因此这只能劳烦你了。由于你不打算真正地帮助她，你无需把答案对998244353998244353取模，也无需对6412364123取模，只要告诉她对1926081719260817取模之后的答案即可。

## 输入输出格式

输入格式：



第一行输入一个q*q*，表示有q*q*次询问。

第二行开始，一共q*q*行，每行两个数字n,m*n*,*m*，意思如题所示。



输出格式：



一共q*q*行，对于每一个询问，都输出一个答案。



## 输入输出样例

输入样例#1：

 

复制

```
5
2 3
1 4
4 3
2 5
3 5
```

输出样例#1：

 

复制

```
10
10
11
35
50
```

## 说明

![img](https://i.loli.net/2018/12/15/5c148dbe83f11.jpg)

关于组合数的样例说明。

例如有蕾米莉亚 芙兰朵露 圣白莲 丰聪耳神子在这一天组合出场，会有六种情况：

1、蕾米莉亚x芙兰朵露 \text{\color{white}背德组}背德组

2、丰聪耳神子x圣白莲 \text{\color{white}宗教组}宗教组

3、蕾米莉亚x丰聪耳神子

4、芙兰朵露x丰聪耳神子

5、蕾米莉亚x圣白莲

6、芙兰朵露x圣白莲

---

# 题解

```c++
#include<cstdio>
#include<cstring>
#include<iostream>
using namespace std;
long long c[1001][1001];
long long sum[1002][1002];
long long mode = 19260817;
int count_zu(int i,int j){
	if(i==j||i==0){
		return 1;
	}else{
		return (c[i][j-1]+c[i-1][j-1])%mode;
	}
} 
int count_sum(int i,int j){
	if(i>j){
		return sum[i-1][j];
	}else if(i == 0){
		return j;
	}else{
		return (sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1]+c[i][j]+mode)%mode;
	}
}
int main(){
	//计算组合数 
	c[0][1] = c[1][1] = 1;
	for (int j = 2;j < 1001; j++)
		for(int i = 0;i <= j; i++)
			c[i][j] = count_zu(i,j);
	//计算和 
	for (int j = 1;j < 1001; j++)
		for(int i = 1;i < 1001; i++)
				sum[i][j] = count_sum(i,j);
	int q;
	cin >> q;
	while(q-->0){
		int i,j;
		cin>>i>>j;
		printf("%lld\n",sum[i][j]);
	}
	return 0;
} 
```

---

## 参考

作者: [chen_zhe](https://www.luogu.org/space/show?uid=8457) **Aya** 更新时间: 2019-03-02 18:21 

> 赋值粘贴后乱码了orz

------

# 洛谷19年三月月赛I T2 回忆京都

当然本质上只是变相性上传一个二维前缀和的模板题而已（

因此在这里说明的稍微详细一点吧。

首先关于组合数C_m^n*C**m**n*，有一个递推公式C_m^n=C_{m-1}^{n}+C_{m-1}^{n-1}*C**m**n*=*C**m*−1*n*+*C**m*−1*n*−1。这个公式可以不用组合数定义强行拆开来暴力算，我们可以这么理解。

现在在班级里面有m*m*个人，其中一个人被钦定了是班长。现在老师想要续了其中的n*n*个人。那么有两种情况。一个是要续了班长，这个时候就有C_{m-1}^{n-1}*C**m*−1*n*−1种情况。还有一种情况就是不去续班长，那么就是C_{m-1}^{n}*C**m*−1*n*中情况。加起来就是C_m^n*C**m**n*了。

那么也就是我们可以用一种类似杨辉三角的方式去递推出一个1000 \times 10001000×1000的组合数表

那么如何快速求出\sum_{i=1}^n \sum_{j=1}^m C^i_j∑*i*=1*n*∑*j*=1*m**C**j**i*呢？

首先先默认大家知道前缀和怎么用了，定义sum[i]*s**u**m*[*i*]为前i*i*（包括i*i*）个数字之和就是sum[i]=sum[i-1]+val[i]*s**u**m*[*i*]=*s**u**m*[*i*−1]+*v**a**l*[*i*]

那么把这个前缀和拓展到二维，同样定义sum[i][j]*s**u**m*[*i*][*j*]为前i*i*行前j*j*列（包括i,j*i*,*j*）所有数字之和，则有sum[i][j]=sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1]+val[i][j]*s**u**m*[*i*][*j*]=*s**u**m*[*i*−1][*j*]+*s**u**m*[*i*][*j*−1]−*s**u**m*[*i*−1][*j*−1]+*v**a**l*[*i*][*j*]

见图（拙劣的画图）

![img](https://i.loli.net/2019/03/02/5c7a0aec638c7.png)

如图，其中蓝色+绿色的区域为sum[i][j-1]*s**u**m*[*i*][*j*−1]，蓝色+黄色的区域为sum[i-1][j]*s**u**m*[*i*−1][*j*]，紫色的区域为val[i][j]*v**a**l*[*i*][*j*]，整个大正方形的区域为sum[i][j]*s**u**m*[*i*][*j*]。

那么有一点是显然的，sum[i-1][j]+sum[i][j-1]*s**u**m*[*i*−1][*j*]+*s**u**m*[*i*][*j*−1]，将蓝色的部分多加了一遍，因此结果会偏大。

为了让结果正常，我们需要减去蓝色的部分，也就是减去sum[i-1][j-1]*s**u**m*[*i*−1][*j*−1]

最后不要忘记在中间过程中（不管是组合数还是处理二维前缀和），都要记得取模。还有一些情况就是在减去sum[i-1][j-1]*s**u**m*[*i*−1][*j*−1]的时候会减到负数，这个时候我们要加上模数，防止因为这个负数模负数出现负数之后，导致后面的结果全都混乱。

所以时间复杂度O*(*n*×*m*+*q*)，其中n*×*m*=1000×1000为组合数预处理复杂度